---
title: "Final Project"
author: Madeleine Bannon
author: 
author: 
output: html_document
---
@chris @charles - this is the outline for our writeup. feel free to add and/or edit it. 
#Executive summary
##Goal of the study
In the last year, the airline industry has experienced an industry upheaval amid the COVID-19 pandemic. However, with contrainment progress from the rollout of the COVID-19 pandemic, traveler confidence has increasingly been restored. As such, as airlines and travelers return to pre-pandemic travel patterns, we thought it would be interesting to explore flight route patterns to better understand airline and airport reliaiblity.

In this study, we aim to answer the following questions: 
+ What factors impact airline reliability the most? 
  + What causes a delay vs. what causes a cancellation?
  + Is there a difference between departure delays and arrival delays?
+ What factors impact the length of a cancellation? 
+ Which airlines are the most reliable?
+ Which locations experience the least amount of delays?
+ How does time of year impact flight reliability?

##Background

 Delays have plagued the air transportation industry since its inception, and remain a consistent pain point for most, if not all airlines today. In 2019, the United States Department of Transportation ("US DOT") reported that airline reliability performance worsened from the previous year, noting that 79% of all flights arrived on-time. However, "on-time" is defined as "one that arrives no more than 15 minutes after its scheduled arrival," a time frame that could easily result in a missed connection (NYT).



source: https://www.nytimes.com/2020/02/19/business/air-travel-delays-airlines.html


##Data
This dataset is from the United States Department of Travel Air Travel Consumer Report and includes records for 5M+ commercial airline flights in 2015. Each record represents a single flight (one-way) including information about the flight, such as the airline, origin/destination airport, schedule/actual flight times (departure and arrival).

###Data cleanup and extraction

[INSERT ANY CHANGES TO DATA HERE]

###Predictor variables
Our response variable is [INSERT] which represents [INSERT].

[INSERT TABLE OF ALL VARIABLES]
##Findings

#Detailed analysis
##Model 1 [to be filled in further]
##Model 2 [to be filled in further]
#Appendix
##Exhibit 1
##Exhibit [##]

@chris @charles - proposed managerial  questions [and analyses]
+ What factors impact airline reliability the most? [logistic regression (lasso?) & random forest]
  + What causes a delay vs. what causes a cancellation?
  + Is there a difference between departure delays and arrival delays?

+ What factors impact the length of a cancellation? [multivariate regression (lasso?) & random forest]

[EDA for below?]
+ Which airlines are the most reliable?
+ Which locations experience the least amount of delays?
+ How does time of year impact flight reliability?
 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.width = 7, fig.height = 4)
if(!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, ggplot2, glmnet, car, data.table, tidyverse, dlookr, skimr)   #add your packages here
```

```{r data upload, include=FALSE}
airline_data <- read.csv("data/flights.csv")
```

```{r}

diagnose(airline_data)

tail(airline_data, 50)

skim(airline_data)

```

```{r create dataset we want, message=FALSE, echo=FALSE, warning=FALSE, include=FALSE, eval=FALSE}
#create new variables
airline_data_new <- airline_data %>% mutate(FLIGHT_DELAY_15 = ifelse(DEPARTURE_DELAY>15, 1, ifelse(ARRIVAL_DELAY>15, 1, 0)),
                                            FLIGHT_DELAY_5 = ifelse(DEPARTURE_DELAY>5, 1, ifelse(ARRIVAL_DELAY>5, 1, 0)))

table(airline_data_new$FLIGHT_DELAY_15)

airline_pct_delay_15 <- airline_data_new %>% select(AIRLINE, FLIGHT_DELAY_15)  %>% group_by(AIRLINE, FLIGHT_DELAY_15) %>% summarize(subtotals = n()) %>% mutate(percent = (subtotals / sum(subtotals) * 100)) #%>% drop_na() %>% filter(FLIGHT_DELAY_15==1) %>% select(AIRLINE, percent)

head(airline_pct_delay_15, 20)

airline_pct_delay_5 <- airline_data_new %>% select(AIRLINE, FLIGHT_DELAY_5) %>% group_by(AIRLINE, FLIGHT_DELAY_5) %>% summarize(subtotals = n()) %>% mutate(percent = (subtotals / sum(subtotals) * 100)) %>% drop_na() %>% filter(FLIGHT_DELAY_5==1) %>% select(AIRLINE, percent)

head(airline_pct_delay_5, 20)


```

```{r absolute number of flights}

total_flights <- ggplot(airline_data_new, aes(x=AIRLINE)) + 
  geom_bar()

print(total_flights)
```

```{r flight delay percentage using standard delay definition}

total_flights_delayed_pct <- ggplot(airline_pct_delay_15, aes(x=reorder(AIRLINE, -percent), y=percent)) + 
  geom_bar(stat = "identity")

print(total_flights_delayed_pct)

```


```{r absolute number of flights cancelled by airline}
airline_delay  <- ggplot(airline_data_new, aes(x=AIRLINE, y=FLIGHT_DELAY_15)) + 
  geom_bar(stat = "identity")

airline_diverted <- ggplot(airline_data_new, aes(x=AIRLINE, y=DIVERTED)) + 
  geom_bar(stat = "identity")

airline_cancelled <- ggplot(airline_data_new, aes(x=AIRLINE, y=CANCELLED)) + 
  geom_bar(stat = "identity")

print(airline_delay)
print(airline_diverted)
print(airline_cancelled )
```

